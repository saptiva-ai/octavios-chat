# ============================================================================
# PRODUCTION ENVIRONMENT CONFIGURATION - EXAMPLE
# ============================================================================
# This file is safe to commit to git (contains NO real credentials)
# Copy this file to create your production environment:
#   cp envs/.env.prod.example envs/.env.prod
# Then replace ALL placeholder values with your actual production credentials
#
# SECURITY WARNING:
# - NEVER commit envs/.env.prod to git
# - Use strong passwords (16+ chars, alphanumeric + symbols)
# - Store production secrets in a secure vault
# - Rotate secrets regularly (every 90 days recommended)
# ============================================================================

# ========================================
# PRODUCTION SERVER CONFIGURATION
# ========================================
# Used by deployment scripts (deploy-service.sh, deploy-to-production.sh)
PROD_SERVER_IP=YOUR_SERVER_IP_HERE
PROD_SERVER_USER=YOUR_SSH_USER_HERE
PROD_SERVER_HOST=${PROD_SERVER_USER}@${PROD_SERVER_IP}
PROD_DEPLOY_PATH=/home/YOUR_USER/octavios-chat-bajaware_invex
PROD_DOMAIN=your-production-domain.com

# For granular deployments
DEPLOY_SERVER=${PROD_SERVER_HOST}
DEPLOY_PROJECT_DIR=${PROD_DEPLOY_PATH}

# ========================================
# BASIC CONFIGURATION
# ========================================
COMPOSE_PROJECT_NAME=octavios-chat-bajaware_invex
DOMAIN=${PROD_DOMAIN}
ENVIRONMENT=production
NODE_ENV=production

# ========================================
# FRONTEND CONFIGURATION
# ========================================
# Backend URL for frontend (public API endpoint)
# Replace with your actual backend domain
NEXT_PUBLIC_API_URL=https://back-${PROD_DOMAIN}
BACKEND_API_URL=https://back-${PROD_DOMAIN}

# Feature flags (enable/disable features)
NEXT_PUBLIC_FEATURE_WEB_SEARCH=false
NEXT_PUBLIC_FEATURE_DEEP_RESEARCH=false
NEXT_PUBLIC_FEATURE_ADD_FILES=false
NEXT_PUBLIC_FEATURE_GOOGLE_DRIVE=false
NEXT_PUBLIC_FEATURE_CANVAS=false
NEXT_PUBLIC_FEATURE_AGENT_MODE=false
NEXT_PUBLIC_FEATURE_MIC=false
NEXT_PUBLIC_TOOL_FILES=true

# ========================================
# DATABASE CONFIGURATION
# ========================================
# SECURITY: Use strong passwords (min 16 chars, alphanumeric + symbols)
MONGODB_USER=octavios_user
MONGODB_PASSWORD=REPLACE_WITH_STRONG_MONGODB_PASSWORD
MONGODB_DATABASE=octavios
MONGODB_URL=mongodb://${MONGODB_USER}:${MONGODB_PASSWORD}@mongodb:27017/${MONGODB_DATABASE}?authSource=admin

REDIS_PASSWORD=REPLACE_WITH_STRONG_REDIS_PASSWORD
REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/1

# ========================================
# AUTHENTICATION / SECURITY
# ========================================
# SECURITY: Generate with: openssl rand -base64 32
JWT_SECRET_KEY=REPLACE_WITH_GENERATED_JWT_SECRET
SECRET_KEY=REPLACE_WITH_GENERATED_SECRET_KEY
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7
JWT_ALGORITHM=HS256

# Production security settings (DO NOT CHANGE)
SECURE_COOKIES=true
HTTPS_ONLY=true

# ========================================
# EXTERNAL APIS
# ========================================
# Get your API key from https://saptiva.ai/dashboard
SAPTIVA_API_KEY=REPLACE_WITH_YOUR_SAPTIVA_API_KEY
SAPTIVA_BASE_URL=https://api.saptiva.com
SAPTIVA_API_URL=https://api.saptiva.com
SAPTIVA_TIMEOUT=30
SAPTIVA_MAX_RETRIES=3
NEXT_PUBLIC_SAPTIVA_API_KEY=
NEXT_PUBLIC_SAPTIVA_BASE_URL=https://api.saptiva.com

ALETHEIA_BASE_URL=https://aletheia.saptiva.ai/demo
ALETHEIA_API_URL=https://aletheia.saptiva.ai/demo
ALETHEIA_API_KEY=optional-if-required
ALETHEIA_TIMEOUT=120
ALETHEIA_MAX_RETRIES=3

# ========================================
# DEEP RESEARCH FEATURE FLAGS (P0-DR-KILL-001)
# ========================================
DEEP_RESEARCH_KILL_SWITCH=true
DEEP_RESEARCH_ENABLED=false
DEEP_RESEARCH_AUTO=false
DEEP_RESEARCH_COMPLEXITY_THRESHOLD=0.7

# ========================================
# CHAT CONFIGURATION (P0-CHAT-BASE-004)
# ========================================
CHAT_DEFAULT_MODEL=Saptiva Turbo
CHAT_ALLOWED_MODELS=Saptiva Turbo,Saptiva Cortex,Saptiva Ops,Saptiva Coder

# Files tool flags
TOOL_FILES_ENABLED=true
TOOL_ADD_FILES_ENABLED=true
TOOL_DOCUMENT_REVIEW_ENABLED=true

# Bank Advisor tool flag
TOOL_BANK_ADVISOR_ENABLED=false

# ========================================
# PRODUCTION SETTINGS
# ========================================
# DO NOT CHANGE THESE VALUES
DEBUG=false
LOG_LEVEL=info
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=200

# ========================================
# FILE UPLOAD LIMITS
# ========================================
MAX_FILE_SIZE=52428800
NEXT_PUBLIC_MAX_FILE_SIZE_MB=50

# ========================================
# CORS & HOSTS
# ========================================
# Replace with your actual production domains
CORS_ORIGINS=["https://${PROD_DOMAIN}","https://back-${PROD_DOMAIN}"]
ALLOWED_HOSTS=["${PROD_DOMAIN}","back-${PROD_DOMAIN}","localhost","127.0.0.1","web","api","backend","testserver"]
ALLOWED_ORIGINS=https://${PROD_DOMAIN},https://back-${PROD_DOMAIN}

# ========================================
# OBSERVABILITY
# ========================================
OTEL_SERVICE_NAME=octavios-bridge-prod
JAEGER_ENDPOINT=http://localhost:14268/api/traces
HOST=0.0.0.0
PORT=8001

# ========================================
# OBJECT STORAGE (MINIO)
# ========================================
# SECURITY: Change default credentials
MINIO_ACCESS_KEY=REPLACE_WITH_MINIO_ACCESS_KEY
MINIO_SECRET_KEY=REPLACE_WITH_MINIO_SECRET_KEY
MINIO_ENDPOINT=minio:9000
MINIO_ROOT_USER=${MINIO_ACCESS_KEY}
MINIO_ROOT_PASSWORD=${MINIO_SECRET_KEY}
MINIO_DEFAULT_PUBLIC_HOST=https://${PROD_DOMAIN}:9000
MINIO_SECURE=false

# ========================================
# EMAIL / PASSWORD RESET CONFIGURATION
# ========================================
# For Gmail: Use App Password (not regular password)
# Generate at: https://myaccount.google.com/apppasswords
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=REPLACE_WITH_GMAIL_APP_PASSWORD
MAIL_FROM=${MAIL_USERNAME}
MAIL_FROM_NAME="Octavios Support"
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587

SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=${MAIL_USERNAME}
SMTP_PASSWORD=${MAIL_PASSWORD}
SMTP_FROM_EMAIL=${MAIL_USERNAME}

# Password reset URL (production frontend)
PASSWORD_RESET_URL_BASE=https://${PROD_DOMAIN}

# ========================================
# FILES TOOL V1 CONFIGURATION
# ========================================
FILES_ROOT=/tmp/copilotos_documents
FILES_TTL_DAYS=1
FILES_QUOTA_MB_PER_USER=500
DOCUMENTS_REAPER_INTERVAL_SECONDS=1800
DOCUMENTS_MAX_DISK_USAGE_PERCENT=85

# ========================================
# BACKGROUND TASKS
# ========================================
CELERY_BROKER_URL=redis://:${REDIS_PASSWORD}@redis:6379/1
CELERY_RESULT_BACKEND=redis://:${REDIS_PASSWORD}@redis:6379/2

# ========================================
# TEXT EXTRACTION CONFIGURATION
# ========================================
EXTRACTOR_PROVIDER=third_party

# ========================================
# POSTGRES (BANK ADVISOR)
# ========================================
# SECURITY: Use strong password (min 16 chars)
POSTGRES_USER=octavios
POSTGRES_PASSWORD=REPLACE_WITH_STRONG_POSTGRES_PASSWORD
POSTGRES_DB=bankadvisor
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# ========================================
# QDRANT (VECTOR DATABASE)
# ========================================
QDRANT_HOST=qdrant
QDRANT_PORT=6333
QDRANT_GRPC_PORT=6334
QDRANT_COLLECTION_NAME=rag_documents
QDRANT_EMBEDDING_DIM=384
QDRANT_LOG_LEVEL=INFO

# ========================================
# RAG CONFIGURATION
# ========================================
RAG_SESSION_TTL_HOURS=24
RAG_CLEANUP_INTERVAL_HOURS=1

# ============================================================================
# DEPLOYMENT INSTRUCTIONS
# ============================================================================
#
# 1. SETUP PRODUCTION ENVIRONMENT FILE:
#    cp envs/.env.prod.example envs/.env.prod
#
# 2. REPLACE ALL PLACEHOLDERS:
#    - PROD_SERVER_IP: Your production server IP
#    - PROD_SERVER_USER: SSH user (e.g., ubuntu, jf)
#    - PROD_DOMAIN: Your production domain (e.g., invex.saptiva.com)
#    - MONGODB_PASSWORD: Generate with: openssl rand -base64 24
#    - REDIS_PASSWORD: Generate with: openssl rand -base64 24
#    - JWT_SECRET_KEY: Generate with: openssl rand -base64 32
#    - SECRET_KEY: Generate with: openssl rand -base64 32
#    - SAPTIVA_API_KEY: Get from https://saptiva.ai/dashboard
#    - POSTGRES_PASSWORD: Generate with: openssl rand -base64 24
#    - MINIO_ACCESS_KEY: Generate with: openssl rand -base64 16
#    - MINIO_SECRET_KEY: Generate with: openssl rand -base64 24
#    - MAIL_USERNAME: Your Gmail address
#    - MAIL_PASSWORD: Gmail App Password from https://myaccount.google.com/apppasswords
#
# 3. BUILD PRODUCTION IMAGES:
#    make prod.build
#
# 4. TAG AND PUSH TO DOCKER HUB:
#    ./scripts/deploy/tag-push-service.sh "all" 0.2.2
#
# 5. DEPLOY TO PRODUCTION:
#    export DEPLOY_SERVER="${PROD_SERVER_HOST}"
#    ./scripts/deploy/deploy-service.sh "all" 0.2.2
#
# ============================================================================
# GRANULAR DEPLOYMENT EXAMPLES
# ============================================================================
#
# Deploy only backend:
#   ./scripts/deploy/deploy-service.sh "backend" 0.2.2
#
# Deploy backend and web:
#   ./scripts/deploy/deploy-service.sh "backend web" 0.2.2
#
# Deploy all services:
#   ./scripts/deploy/deploy-service.sh "all" 0.2.2
#
# Detect which services changed:
#   ./scripts/deploy/detect-changes.sh
#
# Build only changed services:
#   make prod.build CHANGED=1
#
# ============================================================================
# SECURITY CHECKLIST
# ============================================================================
#
# Before deploying to production, verify:
# [ ] All REPLACE_WITH_* placeholders replaced with real values
# [ ] All passwords are strong (16+ chars, alphanumeric + symbols)
# [ ] JWT_SECRET_KEY and SECRET_KEY generated with openssl
# [ ] SAPTIVA_API_KEY is valid and has sufficient quota
# [ ] PROD_DOMAIN points to your production server
# [ ] CORS_ORIGINS includes only your production domains
# [ ] DEBUG=false and ENVIRONMENT=production
# [ ] SECURE_COOKIES=true and HTTPS_ONLY=true
# [ ] envs/.env.prod is in .gitignore (verify with: git check-ignore envs/.env.prod)
# [ ] SSL certificates are installed and valid
# [ ] Firewall rules allow only necessary ports (80, 443, 22)
# [ ] Database backups are configured
# [ ] Monitoring and alerting are set up
#
# ============================================================================
# TROUBLESHOOTING
# ============================================================================
#
# If deployment fails:
# 1. Check logs: ssh ${PROD_SERVER_HOST} "cd ${PROD_DEPLOY_PATH} && docker compose logs backend"
# 2. Verify environment variables are loaded: ssh ${PROD_SERVER_HOST} "cd ${PROD_DEPLOY_PATH} && source envs/.env.prod && env | grep SAPTIVA"
# 3. Check disk space: ssh ${PROD_SERVER_HOST} "df -h"
# 4. Verify images pulled: ssh ${PROD_SERVER_HOST} "docker images | grep octavios-invex"
# 5. Check service health: ssh ${PROD_SERVER_HOST} "cd ${PROD_DEPLOY_PATH} && docker compose ps"
#
# For help: Check docs/DEPLOYMENT.md or contact DevOps team
#
# ============================================================================
